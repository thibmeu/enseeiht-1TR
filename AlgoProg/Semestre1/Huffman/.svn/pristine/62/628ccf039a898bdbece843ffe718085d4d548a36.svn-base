/*******************************************************************************
 *  Auteur   : Thibault Meunier
 *  Objectif : Implantation de la List
 ******************************************************************************/

#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include "List.h"

void add_List_solo(List* this, Clef key, Donnee value)
{
	List nouv = malloc(sizeof(struct List));
	init_Couple(&(nouv->couple), key, value);
	nouv->next = *this;
	*this = nouv;
}

void delete_List_solo(List* this)
{
	List tmp = (*this)->next;
	free((*this)->couple.key);
	free(*this);
	*this = tmp;
}

void init_List(List* this)
{
	*this = NULL;
}

bool empty_List(List this)
{
	return this == NULL;
}

void add_List(List* this, Clef key, Donnee value)
{
	List cur = *this;
	
	if(*this == NULL || strcmp((*this)->couple.key, key) == -1)
		add_List_solo(this, key, value);
	else if (strcmp((*this)->couple.key, key) == 0)
		(*this)->couple.value = value;
	else
	{
		List next = cur->next;
		bool noTouch = true;
		
		while (noTouch)
		{
			if(next == NULL || strcmp(next->couple.key, key) == -1)
			{
				add_List_solo(&(cur->next), key, value);
				noTouch = false;
			}
			else if(strcmp(next->couple.key, key) == 0)
			{
				next->couple.value = value;
				noTouch = false;
			}
			else
			{
				cur = next;
				next = next->next;
			}
		}
	}
}

void delete_List(List* this, Clef key)
{
	List cur = *this;
	
	if(cur != NULL)
	{
		List next = cur->next;
		bool noTouch = true;
		
		if (strcmp(cur->couple.key, key) == 0)
		{
			delete_List_solo(this);
			noTouch = false;
		}

		while (next != NULL && noTouch)
		{
			if (strcmp(next->couple.key, key) == 0)
			{
				delete_List_solo(&(cur->next));
				noTouch = false;
			}
			else
			{
				cur = next;
				next = next->next;
			}
		}
	}
}

bool has_key_List(List this, Clef key)
{
	while (this != NULL && strcmp(this->couple.key, key) != 0)
		this = this->next;
	return this != NULL && strcmp(this->couple.key, key) == 0;
}

Donnee getValue_List(List this, Clef key)
{
	while (this != NULL && strcmp(this->couple.key, key) != 0)
		this = this->next;
	return this->couple.value;
}

void clear_List(List* this)
{
	while(*this != NULL)
		delete_List_solo(this);
}

void destroy_List(List* this)
{
	clear_List(this);
}

void print_List(List this)
{
	while(this != NULL)
	{
		printf("-->[ \"%s\"=%d ]", this->couple.key, this->couple.value);
		this = this->next;
	}
	printf("--E\n");
}
